{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhruvashedbalkar/Desktop/QB.Club/lib/db.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb'\n\nlet client: MongoClient | null = null\nlet db: Db | null = null\n\nexport async function getDb(): Promise<Db> {\n  const uri = process.env.MONGODB_URI\n  if (!uri) {\n    throw new Error('MONGODB_URI env var is not set')\n  }\n\n  if (db) return db\n\n  if (!client) {\n    client = new MongoClient(uri)\n    await client.connect()\n  }\n\n  db = client.db(process.env.MONGODB_DB || 'BCQC')\n\n  const users = db.collection('users')\n  await users.createIndex({ email: 1 }, { unique: true })\n\n  return db\n}\n\nexport async function closeDb() {\n  if (client) {\n    await client.close()\n    client = null\n    db = null\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,SAA6B;AACjC,IAAI,KAAgB;AAEb,eAAe;IACpB,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;IACnC,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,IAAI,OAAO;IAEf,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IAEA,KAAK,OAAO,EAAE,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;IAEzC,MAAM,QAAQ,GAAG,UAAU,CAAC;IAC5B,MAAM,MAAM,WAAW,CAAC;QAAE,OAAO;IAAE,GAAG;QAAE,QAAQ;IAAK;IAErD,OAAO;AACT;AAEO,eAAe;IACpB,IAAI,QAAQ;QACV,MAAM,OAAO,KAAK;QAClB,SAAS;QACT,KAAK;IACP;AACF"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhruvashedbalkar/Desktop/QB.Club/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nexport const runtime = 'nodejs'\nimport { getDb } from '@/lib/db'\nimport * as crypto from 'crypto'\n\nfunction verifyPassword(stored: string, password: string) {\n  try {\n    const [saltHex, keyHex] = stored.split(':')\n    const expectedBuf = Buffer.from(keyHex, 'hex')\n    const expected = new Uint8Array(expectedBuf)\n    return new Promise<boolean>((resolve, reject) => {\n      crypto.scrypt(password, saltHex, expected.length, (err, derivedKey) => {\n        if (err) {\n          reject(err)\n          return\n        }\n        const dkBuf = Buffer.isBuffer(derivedKey)\n          ? (derivedKey as Buffer)\n          : Buffer.from(derivedKey as any as Uint8Array)\n        const dk = new Uint8Array(dkBuf)\n        resolve(crypto.timingSafeEqual(expected, dk))\n      })\n    })\n  } catch {\n    return Promise.resolve(false)\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json()\n    const { email, password } = body as { email?: string; password?: string }\n\n    if (!email || !password) {\n      return NextResponse.json({ error: 'Email and password are required' }, { status: 400 })\n    }\n    if (!isValidEmail(email)) {\n      return NextResponse.json({ error: 'Email must match nnmYYddddd@nmamit.in' }, { status: 400 })\n    }\n\n    const db = await getDb()\n    interface User { passwordHash: string }\n    const users = db.collection<User>('users')\n\n    const user = await users.findOne({ email })\n    if (!user) {\n      return NextResponse.json({ error: 'Invalid credentials' }, { status: 401 })\n    }\n\n    const ok = await verifyPassword(user.passwordHash, password)\n    if (!ok) {\n      return NextResponse.json({ error: 'Invalid credentials' }, { status: 401 })\n    }\n\n    const sessionId = crypto.randomBytes(24).toString('hex')\n    const sessions = (await getDb()).collection('sessions')\n    await sessions.insertOne({ sessionId, email, createdAt: new Date(), expiresAt: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7) })\n\n    const res = NextResponse.json({ success: true })\n    res.cookies.set('session_id', sessionId, {\n      httpOnly: true,\n      sameSite: 'lax',\n      secure: process.env.NODE_ENV === 'production',\n      path: '/',\n      maxAge: 60 * 60 * 24 * 7,\n    })\n    return res\n  } catch (e) {\n    const msg = e instanceof Error ? e.message : 'Unexpected error'\n    return NextResponse.json({ error: msg }, { status: 500 })\n  }\n}\nfunction isValidEmail(email: string) {\n  const re = /^nnm\\d{2}[a-z]{2}\\d{3}@nmamit\\.in$/\n  return re.test(email)\n}"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;;AAFO,MAAM,UAAU;;;AAIvB,SAAS,eAAe,MAAc,EAAE,QAAgB;IACtD,IAAI;QACF,MAAM,CAAC,SAAS,OAAO,GAAG,OAAO,KAAK,CAAC;QACvC,MAAM,cAAc,OAAO,IAAI,CAAC,QAAQ;QACxC,MAAM,WAAW,IAAI,WAAW;QAChC,OAAO,IAAI,QAAiB,CAAC,SAAS;YACpC,+GAAa,CAAC,UAAU,SAAS,SAAS,MAAM,EAAE,CAAC,KAAK;gBACtD,IAAI,KAAK;oBACP,OAAO;oBACP;gBACF;gBACA,MAAM,QAAQ,OAAO,QAAQ,CAAC,cACzB,aACD,OAAO,IAAI,CAAC;gBAChB,MAAM,KAAK,IAAI,WAAW;gBAC1B,QAAQ,wHAAsB,CAAC,UAAU;YAC3C;QACF;IACF,EAAE,OAAM;QACN,OAAO,QAAQ,OAAO,CAAC;IACzB;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACvF;QACA,IAAI,CAAC,aAAa,QAAQ;YACxB,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwC,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QAEA,MAAM,KAAK,MAAM,IAAA,6IAAK;QAEtB,MAAM,QAAQ,GAAG,UAAU,CAAO;QAElC,MAAM,OAAO,MAAM,MAAM,OAAO,CAAC;YAAE;QAAM;QACzC,IAAI,CAAC,MAAM;YACT,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,KAAK,MAAM,eAAe,KAAK,YAAY,EAAE;QACnD,IAAI,CAAC,IAAI;YACP,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,YAAY,oHAAkB,CAAC,IAAI,QAAQ,CAAC;QAClD,MAAM,WAAW,CAAC,MAAM,IAAA,6IAAK,GAAE,EAAE,UAAU,CAAC;QAC5C,MAAM,SAAS,SAAS,CAAC;YAAE;YAAW;YAAO,WAAW,IAAI;YAAQ,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,OAAO,KAAK,KAAK,KAAK;QAAG;QAE9H,MAAM,MAAM,8XAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;QAC9C,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,WAAW;YACvC,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,QAAQ,KAAK,KAAK,KAAK;QACzB;QACA,OAAO;IACT,EAAE,OAAO,GAAG;QACV,MAAM,MAAM,aAAa,QAAQ,EAAE,OAAO,GAAG;QAC7C,OAAO,8XAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAI,GAAG;YAAE,QAAQ;QAAI;IACzD;AACF;AACA,SAAS,aAAa,KAAa;IACjC,MAAM,KAAK;IACX,OAAO,GAAG,IAAI,CAAC;AACjB"}}]
}