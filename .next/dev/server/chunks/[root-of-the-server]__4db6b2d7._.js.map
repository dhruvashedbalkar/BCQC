{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhruvashedbalkar/Desktop/QB.Club/lib/db.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb'\n\nlet client: MongoClient | null = null\nlet db: Db | null = null\n\nexport async function getDb(): Promise<Db> {\n  const uri = process.env.MONGODB_URI\n  if (!uri) {\n    throw new Error('MONGODB_URI env var is not set')\n  }\n\n  if (db) return db\n\n  if (!client) {\n    client = new MongoClient(uri)\n    await client.connect()\n  }\n\n  db = client.db(process.env.MONGODB_DB || 'BCQC')\n\n  const users = db.collection('users')\n  await users.createIndex({ email: 1 }, { unique: true })\n\n  return db\n}\n\nexport async function closeDb() {\n  if (client) {\n    await client.close()\n    client = null\n    db = null\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,SAA6B;AACjC,IAAI,KAAgB;AAEb,eAAe;IACpB,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;IACnC,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,IAAI,OAAO;IAEf,IAAI,CAAC,QAAQ;QACX,SAAS,IAAI,sHAAW,CAAC;QACzB,MAAM,OAAO,OAAO;IACtB;IAEA,KAAK,OAAO,EAAE,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;IAEzC,MAAM,QAAQ,GAAG,UAAU,CAAC;IAC5B,MAAM,MAAM,WAAW,CAAC;QAAE,OAAO;IAAE,GAAG;QAAE,QAAQ;IAAK;IAErD,OAAO;AACT;AAEO,eAAe;IACpB,IAAI,QAAQ;QACV,MAAM,OAAO,KAAK;QAClB,SAAS;QACT,KAAK;IACP;AACF"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhruvashedbalkar/Desktop/QB.Club/app/api/auth/register/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nexport const runtime = 'nodejs'\nimport { getDb } from '@/lib/db'\nimport * as crypto from 'crypto'\n\nfunction isValidEmail(email: string) {\n  const re = /^nnm\\d{2}[a-z]{2}\\d{3}@nmamit\\.in$/\n  return re.test(email)\n}\n\nfunction isValidWallet(addr?: string) {\n  if (!addr) return true\n  return /^0x[a-fA-F0-9]{40}$/.test(addr)\n}\n\nasync function hashPassword(password: string) {\n  const salt = crypto.randomBytes(16).toString('hex')\n  const keyHex = await new Promise<string>((resolve, reject) => {\n    crypto.scrypt(password, salt, 64, (err, derivedKey) => {\n      if (err) {\n        reject(err)\n        return\n      }\n      const dkBuf = Buffer.isBuffer(derivedKey)\n        ? (derivedKey as Buffer)\n        : Buffer.from(derivedKey as any as Uint8Array)\n      resolve(dkBuf.toString('hex'))\n    })\n  })\n  return `${salt}:${keyHex}`\n}\n\ninterface User {\n  email: string\n  passwordHash: string\n  walletAddress: string | null\n  createdAt: Date\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json()\n    const { email, password, walletAddress } = body as {\n      email?: string\n      password?: string\n      walletAddress?: string\n    }\n\n    if (!email || !password) {\n      return NextResponse.json({ error: 'Email and password are required' }, { status: 400 })\n    }\n    if (!isValidEmail(email)) {\n      return NextResponse.json({ error: 'Email must match nnmYYddddd@nmamit.in' }, { status: 400 })\n    }\n    if (!isValidWallet(walletAddress)) {\n      return NextResponse.json({ error: 'Invalid wallet address' }, { status: 400 })\n    }\n\n    const db = await getDb()\n    const users = db.collection<User>('users')\n\n    const existing = await users.findOne({ email })\n    if (existing) {\n      return NextResponse.json({ error: 'Email already registered' }, { status: 409 })\n    }\n\n    const passwordHash = await hashPassword(password)\n\n    const doc: User = {\n      email,\n      passwordHash,\n      walletAddress: walletAddress || null,\n      createdAt: new Date(),\n    }\n    await users.insertOne(doc)\n\n    const sessionId = crypto.randomBytes(24).toString('hex')\n    const sessions = (await getDb()).collection('sessions')\n    await sessions.insertOne({ sessionId, email, createdAt: new Date(), expiresAt: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7) })\n\n    const res = NextResponse.json({ success: true })\n    res.cookies.set('session_id', sessionId, {\n      httpOnly: true,\n      sameSite: 'lax',\n      secure: process.env.NODE_ENV === 'production',\n      path: '/',\n      maxAge: 60 * 60 * 24 * 7,\n    })\n    return res\n  } catch (e) {\n    const msg = e instanceof Error ? e.message : 'Unexpected error'\n    return NextResponse.json({ error: msg }, { status: 500 })\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;;AAFO,MAAM,UAAU;;;AAIvB,SAAS,aAAa,KAAa;IACjC,MAAM,KAAK;IACX,OAAO,GAAG,IAAI,CAAC;AACjB;AAEA,SAAS,cAAc,IAAa;IAClC,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,sBAAsB,IAAI,CAAC;AACpC;AAEA,eAAe,aAAa,QAAgB;IAC1C,MAAM,OAAO,oHAAkB,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,SAAS,MAAM,IAAI,QAAgB,CAAC,SAAS;QACjD,+GAAa,CAAC,UAAU,MAAM,IAAI,CAAC,KAAK;YACtC,IAAI,KAAK;gBACP,OAAO;gBACP;YACF;YACA,MAAM,QAAQ,OAAO,QAAQ,CAAC,cACzB,aACD,OAAO,IAAI,CAAC;YAChB,QAAQ,MAAM,QAAQ,CAAC;QACzB;IACF;IACA,OAAO,GAAG,KAAK,CAAC,EAAE,QAAQ;AAC5B;AASO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG;QAM3C,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACvF;QACA,IAAI,CAAC,aAAa,QAAQ;YACxB,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwC,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QACA,IAAI,CAAC,cAAc,gBAAgB;YACjC,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,KAAK,MAAM,IAAA,6IAAK;QACtB,MAAM,QAAQ,GAAG,UAAU,CAAO;QAElC,MAAM,WAAW,MAAM,MAAM,OAAO,CAAC;YAAE;QAAM;QAC7C,IAAI,UAAU;YACZ,OAAO,8XAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,eAAe,MAAM,aAAa;QAExC,MAAM,MAAY;YAChB;YACA;YACA,eAAe,iBAAiB;YAChC,WAAW,IAAI;QACjB;QACA,MAAM,MAAM,SAAS,CAAC;QAEtB,MAAM,YAAY,oHAAkB,CAAC,IAAI,QAAQ,CAAC;QAClD,MAAM,WAAW,CAAC,MAAM,IAAA,6IAAK,GAAE,EAAE,UAAU,CAAC;QAC5C,MAAM,SAAS,SAAS,CAAC;YAAE;YAAW;YAAO,WAAW,IAAI;YAAQ,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,OAAO,KAAK,KAAK,KAAK;QAAG;QAE9H,MAAM,MAAM,8XAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;QAC9C,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,WAAW;YACvC,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,QAAQ,KAAK,KAAK,KAAK;QACzB;QACA,OAAO;IACT,EAAE,OAAO,GAAG;QACV,MAAM,MAAM,aAAa,QAAQ,EAAE,OAAO,GAAG;QAC7C,OAAO,8XAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAI,GAAG;YAAE,QAAQ;QAAI;IACzD;AACF"}}]
}